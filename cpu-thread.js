(()=>{"use strict";function n(n){return r(n,e(n)+2)}function e(n){return n.programCounter[0]}function r(n,e){return n.programCounter[0]=e}function t(n){return n.I[0]}function u(n,e){return n.I[0]=e}function c(n,e){return n.registers[15]=e}function o(n,e){return n.registers[e]}function a(n,e,r){return n.registers[e]=r}function i(n){return function(n){return 15&f(n)}(n)}function s(n){return 4095&function(n){return n.uint16[0]}(n)}function f(n){return n.uint8[1]}function b(n){return n.uint8[0]}function k(n){return function(n){return 15&b(n)}(n)}function l(n){return function(n){return f(n)>>>4}(n)}function y(n){return f(n)}Uint8Array.from([110,5,101,0,107,6,106,0,163,12,218,177,122,4,58,64,18,8,123,2,59,18,18,6,108,32,109,31,163,16,220,209,34,246,96,0,97,0,163,18,208,17,112,8,163,14,208,17,96,64,240,21,240,7,48,0,18,52,198,15,103,30,104,1,105,255,163,14,214,113,163,16,220,209,96,4,224,161,124,254,96,6,224,161,124,2,96,63,140,2,220,209,163,14,214,113,134,132,135,148,96,63,134,2,97,31,135,18,71,31,18,172,70,0,104,1,70,63,104,255,71,0,105,1,214,113,63,1,18,170,71,31,18,170,96,5,128,117,63,0,18,170,96,1,240,24,128,96,97,252,128,18,163,12,208,113,96,254,137,3,34,246,117,1,34,246,69,96,18,222,18,70,105,255,128,96,128,197,63,1,18,202,97,2,128,21,63,1,18,224,128,21,63,1,18,238,128,21,63,1,18,232,96,32,240,24,163,14,126,255,128,224,128,4,97,0,208,17,62,0,18,48,18,222,120,255,72,254,104,255,18,238,120,1,72,2,104,1,96,4,240,24,105,255,18,112,163,20,245,51,242,101,241,41,99,55,100,0,211,69,115,5,242,41,211,69,0,238,224,0,128,0,252,0,170,0,0,0,0,0]),Uint8Array.from([0,224,99,0,100,1,101,238,53,238,19,16,99,0,100,2,101,238,102,238,85,96,19,16,99,0,100,3,101,238,69,253,19,16,99,0,100,4,101,238,117,1,53,239,19,16,99,0,100,5,111,1,101,238,102,239,133,101,63,0,19,16,99,0,100,6,111,0,101,239,102,238,133,101,63,1,19,16,111,0,99,0,100,7,101,238,102,239,133,103,63,1,19,16,99,0,100,8,111,1,101,239,102,238,133,103,63,0,19,16,99,0,100,9,101,240,102,15,133,97,53,255,19,16,99,1,100,0,101,240,102,15,133,98,53,0,19,16,99,1,100,1,101,240,102,15,133,99,53,255,19,16,111,0,99,1,100,2,101,129,133,14,63,1,19,16,99,1,100,3,111,1,101,71,133,14,63,0,19,16,99,1,100,4,111,0,101,1,133,6,63,1,19,16,99,1,100,5,111,1,101,2,133,6,63,0,19,16,99,1,100,6,96,21,97,120,163,208,241,85,241,101,48,21,19,16,49,120,19,16,99,1,100,7,96,138,163,208,240,51,163,208,240,101,48,1,19,16,96,1,240,30,240,101,48,3,19,16,96,1,240,30,240,101,48,8,19,16,19,50,19,14,163,42,96,19,97,9,208,24,243,41,96,34,97,11,208,21,244,41,96,40,97,11,208,21,19,14,255,240,240,255,240,240,240,255,163,88,96,21,97,11,99,8,208,24,112,8,243,30,48,45,19,58,163,112,96,2,97,24,99,8,208,24,112,5,243,30,48,62,19,76,19,14,240,136,136,240,136,136,136,240,120,132,132,132,132,132,132,120,132,196,164,148,140,132,132,132,192,160,160,192,160,160,192,0,0,0,160,160,224,32,32,224,0,0,0,0,0,0,0,0,192,160,160,192,160,160,192,0,0,0,96,160,192,128,96,0,0,0,96,128,64,32,192,0,128,128,192,128,128,128,96,0,224,128,128,128,128,128,224,0,0,0,64,160,160,160,64,0,32,32,32,96,160,160,96,0,0,0,96,160,192,128,96,0,0,0,0,96,64,64,80,0,0,0,0,0,0,0]);function p(n,e,r,t){const u=Number(Boolean(t)&&Boolean(d(n,e,r)));return function(n,e,r,t){n.buffer[64*r+e]=t}(n,e,r,d(n,e,r)^t),u}function d(n,e,r){return n.buffer[64*r+e]}function m(n,e,r){return n.buffer[64*r+e]=0}function g(n,e){return n.bytes[e]}function w(n,e,r){return n.bytes[e]=r}function h(n,e){return n.keyboard[e]}function v(n,e){return n%Math.pow(10,e+1)/Math.pow(10,e)|0}function M(n,e){return r(n,e)}function A(e,r,t){o(e,r)===t&&n(e)}function T(e,r,t){o(e,r)!==t&&n(e)}function I(n,e,r){return a(n,e,r)}function U(n,e,r){return function(n,e,r){return a(n,e,o(n,e)+r)}(n,e,r)}function P(n){return g(n,128)}function x(n){return g(n,129)}function B(n,e){return w(n,128,e)}function C(n,e){return w(n,129,e)}function E(r,d,x,E,L,N){const S=e(r),j=function(n){return function(n){return b(n)>>>4}(n)}(d);switch(M(r,S+2),j){case 0:switch(f(d)){case 224:!function(n){for(let e=0;e<32;e++)for(let r=0;r<64;r++)m(n,r,e)}(L);break;case 238:!function(n,e){M(n,function(n){const e=n.stack[n.stackPointer];return n.stackPointer-=1,e}(e))}(r,x)}break;case 1:M(r,s(d));break;case 2:!function(n,r,t){!function(n,e){n.stackPointer+=1,n.stack[n.stackPointer]=e}(r,e(n)),M(n,t)}(r,x,s(d));break;case 3:A(r,k(d),y(d));break;case 4:T(r,k(d),y(d));break;case 5:A(r,k(d),o(r,l(d)));break;case 6:I(r,k(d),y(d));break;case 7:U(r,k(d),y(d));break;case 8:switch(i(d)){case 0:I(r,k(d),o(r,l(d)));break;case 1:!function(n,e,r){a(n,e,o(n,e)|o(n,r))}(r,k(d),l(d));break;case 2:!function(n,e,r){a(n,e,o(n,e)&o(n,r))}(r,k(d),l(d));break;case 3:!function(n,e,r){a(n,e,o(n,e)^o(n,r))}(r,k(d),l(d));break;case 4:c(r,U(r,k(d),o(r,l(d)))>255?1:0);break;case 5:c(r,function(n,e,r){return function(n,e,r){return a(n,e,o(n,e)-r)}(n,e,r)}(r,k(d),o(r,l(d)))>0?1:0);break;case 6:!function(n,e,r){c(n,1&r),function(n,e,r){a(n,e,r>>>1)}(n,e,r)}(r,k(d),o(r,k(d)));break;case 7:c(r,function(n,e,r){return a(n,e,r-o(n,e))}(r,k(d),o(r,l(d)))>0?1:0);break;case 14:!function(n,e,r){c(n,r>>7),function(n,e,r){a(n,e,r<<1)}(n,e,r)}(r,k(d),o(r,k(d)))}break;case 9:T(r,k(d),o(r,l(d)));break;case 10:u(r,s(d));break;case 11:M(r,s(d)+function(n){return n.registers[0]}(r));break;case 12:!function(n,e,r){a(n,e,(255*Math.random()|0)&r)}(r,k(d),y(d));break;case 13:c(r,function(n,e,r,t,u,c){let o=0;for(let a=0;a<c;a++)for(let c=0;c<8;c++)o|=p(n,(e+c)%64,(r+a)%32,g(t,u+a)>>>7-c&1);return o}(L,o(r,k(d)),o(r,l(d)),E,t(r),i(d)));break;case 14:switch(y(d)){case 158:!function(e,r,t){(function(n,e){return 1===h(n,e)})(r,t)&&n(e)}(r,N,o(r,k(d)));break;case 161:!function(e,r,t){(function(n,e){return 0===h(n,e)})(r,t)&&n(e)}(r,N,o(r,k(d)))}break;case 15:switch(y(d)){case 7:I(r,k(d),P(E));break;case 10:{const n=function(n){const e=n.keyboard;for(let n=0;n<e.length;n++)if(1===e[n])return n;return-1}(N);-1!==n?I(r,k(d),n):M(r,S);break}case 21:B(E,o(r,k(d)));break;case 24:C(E,o(r,k(d)));break;case 30:u(r,t(r)+o(r,k(d)));break;case 41:u(r,(0,0+5*o(r,k(d))));break;case 51:{const n=o(r,k(d)),e=t(r);w(E,e+2,v(n,0)),w(E,e+1,v(n,1)),w(E,e,v(n,2));break}case 85:{const n=k(d),e=t(r);for(let t=0;t<=n;t++)w(E,e+t,o(r,t));break}case 101:{const n=k(d),e=t(r);for(let t=0;t<=n;t++)I(r,t,g(E,e+t));break}}}return e(r)}function L(n){const r=(t=function(n,e){return function(n,e,r){return n.bytes.subarray(e,e+2)}(N(n),e)}(n,function(n){return e(function(n){return n.processor}(n))}(n)),{uint8:new Uint8Array(t),uint16:new Uint16Array([t[0]<<8|t[1]])});var t;const u=E(n.processor,r,n.stack,n.memory,n.display,n.keyboard);var c;return P(c=n.memory)>0&&B(c,P(c)-1),function(n,e){x(n)>0&&C(n,x(n)-1)}(n.memory,n.onSoundTime),u}function N(n){return n.memory}new Uint8Array([240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128]);let S=null,j=()=>{},q=1e3/60,z=null;function D(){!function(n){Atomics.wait(n.buffer,n.index,1)}(z),L(S)}self.addEventListener("message",(n=>{const{data:{eventType:e,payload:r}}=n;switch(e){case 0:S=r.chip8,u=(c=N(S),c.bytes).buffer,127,z={buffer:new Int32Array(u),index:127},self.postMessage(function(n,e=!1){return{eventType:0,payload:{chip8:n},error:e}}(S,!1));break;case 1:j(),t=setInterval(D,q),j=function(){clearInterval(t)},D(),self.postMessage(function(n=!1){return{eventType:1,payload:null,error:n}}(!1));break;case 2:q=r.mode,self.postMessage(function(n,e=!1){return{eventType:2,payload:{mode:n},error:e}}(r.mode,!1));break;case 3:L(S),self.postMessage(function(n=!1){return{eventType:3,payload:null,error:n}}(!1));break;case 4:j(),self.postMessage(function(n=!1){return{eventType:4,payload:null,error:n}}(!1))}var t,u,c}))})();